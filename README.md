# BeautyCRM-Mini 微信小程序

## 项目概述

BeautyCRM-Mini是一款专为美容院设计的微信小程序，帮助美容院管理客户信息、服务记录和消费数据。主要功能包括：

- Excel数据导入 - 批量导入客户、服务记录等数据
- 客户管理 - 查看和管理客户基本信息
- 服务记录 - 记录客户每次服务的详细信息
- 数据分析 - 生成客户数据分析报告
- 提示词导出 - 导出提示词模板和完整提示词内容

## 开发进度

当前版本: v0.4.3 (2025-04-10)

### 最新更新

- ✅ 修复项目详情页空白问题，添加了缺失的JSON配置文件
- ✅ 修复上传页面WXML文件缺失错误，添加了上传页面相关文件
- ✅ 修复智能分析页面客户数据加载问题，添加对308重定向响应的处理
- ✅ 修复多个页面JSON配置文件缺失问题，确保所有页面都有完整的配置文件
- ✅ 优化页面加载状态显示，添加错误信息和空数据的展示
- ✅ 改进API请求处理逻辑，添加了完整的重定向处理和错误处理

- ✅ 配置服务器环境，完成 Flask 应用部署
- ✅ 设置 Gunicorn 作为 WSGI 服务器
- ✅ 优化服务器配置，确保安全和稳定性
- ✅ 配置服务器 SSH 访问和权限管理
- ✅ 修复HTML解析器渲染问题，增强报告展示稳定性
- ✅ 优化报告详情页，添加多层次的内容显示机制，确保HTML内容始终可见
- ✅ 改进HTML内容格式化逻辑，自动为纯文本添加HTML标记
- ✅ 增强错误处理能力，防止解析失败导致报告无法显示
- ✅ 优化Excel数据清洗工具，能够准确解析和处理服务项目内容
- ✅ 修复服务项目数据导入流程，确保项目名称、美容师和金额正确保存
- ✅ 改进服务项目模型，支持完整的项目信息记录（名称、美容师、金额、指定状态）
- ✅ 添加服务项目测试脚本，验证Excel处理器解析能力
- ✅ 优化数据导出功能，支持同时展示新旧格式的服务记录
- ✅ 实现了提示词导出功能，支持客户信息、消费记录和项目库数据的完整导出
- ✅ 改进了HTML报告生成和展示功能，优化了报告页面的UI
- ✅ 修复了iOS设备上日期格式化问题，提高了系统兼容性

## 主要功能

### Excel数据处理

- ✅ 支持多种格式的Excel文件导入
- ✅ 智能识别Excel表头和数据格式
- ✅ 自动清洗和标准化数据
- ✅ 导入前数据预览和确认
- ✅ 支持导出数据为Excel和Markdown格式

### 客户管理

- ✅ 客户列表浏览和搜索
- ✅ 客户详情查看
- ✅ 客户服务记录查看
- 🔄 客户编辑功能
- 🔄 客户筛选和分类

### 服务记录

- ✅ 查看服务记录列表
- ✅ 服务记录详情展示
- ✅ 服务项目详情查看
- ✅ 服务项目数据处理与存储
- 🔄 服务记录搜索和筛选
- 🔄 服务记录统计分析

### 数据分析与报告

- ✅ 生成客户分析报告（HTML格式）
- ✅ 提示词导出和查看功能
- ✅ 历史报告管理和查看
- 🔄 客户消费统计
- 🔄 服务项目热度分析
- ⏳ 美容师业绩分析
- ⏳ 客户画像生成

## 后端技术栈

- Flask - Web框架
- SQLite - 开发环境数据库
- SQLAlchemy - ORM框架
- Pandas - 数据处理
- XlsxWriter/openpyxl - Excel文件处理

## 小程序技术栈

- 原生微信小程序开发
- WXML/WXSS/JS
- 微信云存储
- Charts组件 - 数据可视化
- DeepSeek API - 报告生成

## 安装运行

### 后端

1. 进入server目录
2. 安装依赖：`pip install -r requirements.txt`
3. 运行服务器：`python app.py`

### 小程序

1. 使用微信开发者工具打开mini-program目录
2. 在project.config.json中配置自己的AppID
3. 在app.js中配置API地址为本地服务器地址
4. 编译运行

## 常见问题

### Excel导入问题

如果在导入Excel文件时遇到"连接被拒绝"错误，请确保：

1. 小程序中配置的API地址指向正确的服务器IP（不能使用localhost）
2. 手机和服务器在同一网络环境中
3. 服务器防火墙允许5000端口的访问

具体解决方案可参考：`README_网络连接问题修复.md`

### 服务记录显示问题

如果服务记录导入后在小程序中显示为0条，原因可能是：

1. Excel处理器未能正确解析服务记录数据
2. Series对象处理时出现"The truth value of a Series is ambiguous"错误

最新版本已修复此问题，请确保使用最新代码。

### 日期格式问题

部分iOS设备上使用`new Date("YYYY-MM-DD HH:mm:ss")`格式可能导致日期解析错误，最新版本已通过`_formatDateForIOS`方法修复该问题。

### HTML报告显示问题

如果在查看客户分析报告时，HTML内容未能正确显示，可能的原因包括：

1. HTML解析器组件无法正确处理特定格式的HTML内容
2. 生成的报告内容缺少正确的HTML标签结构
3. 富文本组件(rich-text)渲染异常

最新版本已通过以下方式解决该问题：
- 添加多层次的内容显示机制，确保内容始终可见
- 优化HTML内容格式化，自动添加必要的HTML标记
- 改进错误处理流程，防止解析失败导致整个页面崩溃

如果仍然遇到问题，可以点击"查看示例"按钮查看标准格式的示例内容。

## 项目规划

### 近期计划（1-2周）

- 进一步改进提示词导出功能，支持更多格式导出
- 添加批量导出提示词功能
- 完善服务记录筛选和搜索功能
- 添加服务项目数据统计分析功能

### 中期计划（1-2个月）

- 实现客户画像分析
- 开发会员卡管理功能
- 添加数据备份和恢复功能
- 增强数据可视化分析

### 长期计划

- 多门店数据管理
- 客户关怀提醒系统
- 员工绩效分析系统
- 与业务系统深度集成

## 联系与支持

如有问题或建议，请提交issue或联系项目维护者。