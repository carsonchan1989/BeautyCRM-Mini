<view class="container">
  <!-- æ ‡é¢˜æ  -->
  <view class="header">
    <view class="back-button" bindtap="goBack">
      <text class="back-icon">â†</text>
      <text>è¿”å›</text>
    </view>
    <view class="title">å®¢æˆ·è¯¦æƒ…</view>
    <view class="edit-button" bindtap="editCustomer" wx:if="{{customer}}">
      <text>ç¼–è¾‘</text>
    </view>
  </view>
  
  <!-- é”™è¯¯ä¿¡æ¯ -->
  <view class="error-message" wx:if="{{errorMessage}}">
    <icon type="warn" size="18"></icon>
    <text>{{errorMessage}}</text>
  </view>
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-icon"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <!-- å®¢æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="customer-card" wx:if="{{customer && !isLoading}}">
    <view class="customer-header">
      <view class="avatar-box">
        <text class="avatar-text">{{customer.name ? customer.name.substring(0, 1) : 'å®¢'}}</text>
      </view>
      <view class="customer-basic">
        <view class="customer-name">{{customer.name || 'æœªå‘½åå®¢æˆ·'}}</view>
        <view class="customer-tags">
          <text class="customer-tag">{{customer.gender || 'æœªçŸ¥'}}</text>
          <text class="customer-tag" wx:if="{{customer.age}}">{{customer.age}}å²</text>
          <text class="customer-tag member-tag">{{customer.memberLevel || 'æ™®é€šä¼šå‘˜'}}</text>
        </view>
      </view>
    </view>
    
    <view class="info-section">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">æ‰‹æœºå·</text>
          <text class="info-value">{{customer.phone || 'æœªå¡«å†™'}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ‰€å±é—¨åº—</text>
          <text class="info-value">{{customer.store || 'æ€»åº—'}}</text>
        </view>
        <view class="info-item" wx:if="{{customer.birthday}}">
          <text class="info-label">ç”Ÿæ—¥</text>
          <text class="info-value">{{customer.birthday}}</text>
        </view>
        <view class="info-item" wx:if="{{customer.memberCardNo}}">
          <text class="info-label">ä¼šå‘˜å¡å·</text>
          <text class="info-value">{{customer.memberCardNo}}</text>
        </view>
        <view class="info-item" wx:if="{{customer.address}}">
          <text class="info-label">åœ°å€</text>
          <text class="info-value address">{{customer.address}}</text>
        </view>
      </view>
      
      <view class="info-remarks" wx:if="{{customer.remarks}}">
        <text class="remarks-label">å¤‡æ³¨ï¼š</text>
        <text class="remarks-content">{{customer.remarks}}</text>
      </view>
    </view>
    
    <view class="action-buttons">
      <button class="action-button report" bindtap="generateReport">
        <text class="button-icon">ğŸ“Š</text>
        <text>ç”Ÿæˆåˆ†ææŠ¥å‘Š</text>
      </button>
      <button class="action-button consumption" bindtap="addConsumption">
        <text class="button-icon">+</text>
        <text>æ·»åŠ æ¶ˆè´¹è®°å½•</text>
      </button>
    </view>
  </view>
  
  <!-- æ¶ˆè´¹è®°å½•åˆ—è¡¨ -->
  <view class="consumption-list" wx:if="{{customer && !isLoading}}">
    <view class="list-header">
      <text class="list-title">æ¶ˆè´¹è®°å½•</text>
      <text class="list-count">å…±{{consumptions.length}}æ¡</text>
    </view>
    
    <view class="list-content">
      <view class="consumption-item" 
            wx:for="{{consumptions}}" 
            wx:key="index"
            bindtap="viewConsumptionDetail"
            data-index="{{index}}">
        <view class="consumption-date">{{item.date}}</view>
        <view class="consumption-info">
          <view class="consumption-project">{{item.projectName}}</view>
          <view class="consumption-detail">
            <text class="technician" wx:if="{{item.technician}}">æŠ€å¸ˆ: {{item.technician}}</text>
            <text class="payment" wx:if="{{item.paymentMethod}}">{{item.paymentMethod}}</text>
          </view>
        </view>
        <view class="consumption-amount">Â¥{{item.amount}}</view>
      </view>
      
      <!-- ç©ºæ¶ˆè´¹è®°å½•æç¤º -->
      <view class="empty-tip" wx:if="{{consumptions.length === 0}}">
        <icon type="info" size="40" color="#999"></icon>
        <text>æš‚æ— æ¶ˆè´¹è®°å½•</text>
      </view>
    </view>
  </view>
</view>